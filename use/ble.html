<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>BLE gateway | OpenMQTTGateway v0.9.8</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
    <link rel="icon" href="/img/Openmqttgateway_logo_mini.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <script type="module" src="https://unpkg.com/esp-web-tools@3.4.2/dist/web/install-button.js?module"></script>
    <meta name="description" content="One gateway, many technologies: MQTT gateway for ESP8266, ESP32, Sonoff RF Bridge or Arduino with bidirectional 433mhz/315mhz/868mhz, Infrared communications, BLE, beacons detection, mi flora / mi jia / LYWSD02/ Mi Scale compatibility, SMS & LORA.">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.08acd5a5.css" as="style"><link rel="preload" href="/assets/js/app.90ef2252.js" as="script"><link rel="preload" href="/assets/js/2.c514a7fa.js" as="script"><link rel="preload" href="/assets/js/26.fec69d95.js" as="script"><link rel="prefetch" href="/assets/js/10.39228b7b.js"><link rel="prefetch" href="/assets/js/11.5a058258.js"><link rel="prefetch" href="/assets/js/12.ab60f5b9.js"><link rel="prefetch" href="/assets/js/13.f56761bb.js"><link rel="prefetch" href="/assets/js/14.208a0f03.js"><link rel="prefetch" href="/assets/js/15.567fd94a.js"><link rel="prefetch" href="/assets/js/16.04008d95.js"><link rel="prefetch" href="/assets/js/17.c2912626.js"><link rel="prefetch" href="/assets/js/18.48486b30.js"><link rel="prefetch" href="/assets/js/19.ace78fc1.js"><link rel="prefetch" href="/assets/js/20.7fbb2875.js"><link rel="prefetch" href="/assets/js/21.602218c5.js"><link rel="prefetch" href="/assets/js/22.26efb3fd.js"><link rel="prefetch" href="/assets/js/23.575aadef.js"><link rel="prefetch" href="/assets/js/24.bc7cc79e.js"><link rel="prefetch" href="/assets/js/25.c7a41d5c.js"><link rel="prefetch" href="/assets/js/27.a17d91a4.js"><link rel="prefetch" href="/assets/js/28.f7a12090.js"><link rel="prefetch" href="/assets/js/29.f3d0269d.js"><link rel="prefetch" href="/assets/js/3.fbe80411.js"><link rel="prefetch" href="/assets/js/30.08e755a0.js"><link rel="prefetch" href="/assets/js/31.0f156785.js"><link rel="prefetch" href="/assets/js/32.bfc4740c.js"><link rel="prefetch" href="/assets/js/33.46a999fe.js"><link rel="prefetch" href="/assets/js/34.31b267c6.js"><link rel="prefetch" href="/assets/js/35.5e768642.js"><link rel="prefetch" href="/assets/js/36.dfadf139.js"><link rel="prefetch" href="/assets/js/37.d3b7ed5e.js"><link rel="prefetch" href="/assets/js/38.3a98e386.js"><link rel="prefetch" href="/assets/js/39.d82f756a.js"><link rel="prefetch" href="/assets/js/4.2f2fb506.js"><link rel="prefetch" href="/assets/js/40.bda4445e.js"><link rel="prefetch" href="/assets/js/41.b2686deb.js"><link rel="prefetch" href="/assets/js/42.fecd58eb.js"><link rel="prefetch" href="/assets/js/43.4fa744a2.js"><link rel="prefetch" href="/assets/js/44.c87c2a25.js"><link rel="prefetch" href="/assets/js/45.3a26728c.js"><link rel="prefetch" href="/assets/js/46.529fbc8e.js"><link rel="prefetch" href="/assets/js/5.3465fc36.js"><link rel="prefetch" href="/assets/js/6.fecad515.js"><link rel="prefetch" href="/assets/js/7.3044fe88.js"><link rel="prefetch" href="/assets/js/8.73373fad.js"><link rel="prefetch" href="/assets/js/9.bc349c98.js">
    <link rel="stylesheet" href="/assets/css/0.styles.08acd5a5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">OpenMQTTGateway v0.9.8</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://1technophile.blogspot.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="https://community.openmqttgateway.com" target="_self" class="nav-link external">
  Community
  <!----></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/devices" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Devices
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/boards" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Boards
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/1technophile/OpenMQTTGateway" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://1technophile.blogspot.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="https://community.openmqttgateway.com" target="_self" class="nav-link external">
  Community
  <!----></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/devices" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Devices
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/boards" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Boards
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/1technophile/OpenMQTTGateway" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">0 - What is it for üè†</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>1 - Prerequisitesüß≠</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2 - Set it up üî®</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>3 - Upload ‚û°Ô∏è</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>4 - Use ‚úàÔ∏è</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/use/rf.html" class="sidebar-link">RF gateways  (433mhz/315mhz)</a></li><li><a href="/use/ble.html" aria-current="page" class="active sidebar-link">BLE gateway</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/use/ble.html#receiving-signals-from-ble-beacon-devices-for-presence-detection" class="sidebar-link">Receiving signals from BLE beacon devices for Presence detection</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#receiving-signals-from-ble-devices-mi-flora-mi-jia-lywds02-lywsd03mmc-cleargrass-mi-scale-and-many-more" class="sidebar-link">Receiving signals from BLE devices Mi Flora, Mi jia, LYWDS02, LYWSD03MMC, ClearGrass, Mi scale and many more</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-a-white-or-black-list" class="sidebar-link">Setting a white or black list</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-the-time-between-ble-scans-and-force-a-scan" class="sidebar-link">Setting the time between BLE scans and force a scan</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-the-number-of-scans-between-connection-attempts" class="sidebar-link">Setting the number of scans between connection attempts</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-if-the-gateway-publishes-all-the-ble-devices-scanned-or-only-the-detected-sensors" class="sidebar-link">Setting if the gateway publishes all the BLE devices scanned or only the detected sensors</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-if-the-gateway-connects-to-ble-devices-eligibles-on-esp32" class="sidebar-link">Setting if the gateway connects to BLE devices eligibles on ESP32</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-if-the-gateway-publish-into-home-assistant-home-presence-topic" class="sidebar-link">Setting if the gateway publish into Home Assistant Home presence topic</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#setting-the-minimum-rssi-accepted-to-publish-device-data" class="sidebar-link">Setting the minimum RSSI accepted to publish device data</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#read-write-ble-characteristics-over-mqtt-esp32-only" class="sidebar-link">Read/write BLE characteristics over MQTT (ESP32 only)</a></li><li class="sidebar-sub-header"><a href="/use/ble.html#other" class="sidebar-link">Other</a></li></ul></li><li><a href="/use/ir.html" class="sidebar-link">IR gateway</a></li><li><a href="/use/lora.html" class="sidebar-link">LORA gateway</a></li><li><a href="/use/gsm.html" class="sidebar-link">GSM 2G gateway</a></li><li><a href="/use/rs232.html" class="sidebar-link">RS232 gateway</a></li><li><a href="/use/rfm69.html" class="sidebar-link">RFM69 gateway</a></li><li><a href="/use/sensors.html" class="sidebar-link">Sensors</a></li><li><a href="/use/actuators.html" class="sidebar-link">Actuators</a></li><li><a href="/use/boards.html" class="sidebar-link">Boards</a></li><li><a href="/use/gateway.html" class="sidebar-link">System commands (ESP only)</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>5 - Integrate üéâ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>6 - Participate üíª</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ble-gateway"><a href="#ble-gateway" class="header-anchor">#</a> BLE gateway</h1> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>We strongly encourage the use of a white-list (see below) so as to collect data from your devices only and not from other MAC addresses.
By default the gateway scans the advertizing BLE devices nearby with their MAC addresses. Depending on your country, it may be illegal to monitor networks for MAC addresses, especially on networks that you do not own. Please check your country's laws (for US Section 18 U.S. Code ¬ß 2511) - <a href="https://github.com/schollz/howmanypeoplearearound/issues/4" target="_blank" rel="noopener noreferrer">discussion here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <h2 id="receiving-signals-from-ble-beacon-devices-for-presence-detection"><a href="#receiving-signals-from-ble-beacon-devices-for-presence-detection" class="header-anchor">#</a> Receiving signals from BLE beacon devices for Presence detection</h2> <p>Subscribe to all the messages with mosquitto or open your MQTT client software:</p> <p><code>sudo mosquitto_sub -t +/# -v</code></p> <p><em>NOTE: HM-10 or HM-11 module needed if you are not using ESP32; configure in <code>User_config.h</code></em></p> <p>The BT gateway module for OpenMQTTGateway enables the detection of BLE beacons and their signal strength.  Generally BLE devices will not broadcast if they are paired so you may need to ensure your beacons is unpaired before it will be seen by the gateway.</p> <p>If beacons are detected the gateway will periodically publish messages to MQTT (beacons must not be paired, see above):</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>home/OpenMQTTGateway/BTtoMQTT/45E174126E00 {&quot;id&quot;:&quot;45:e1:74:12:6e:00&quot;,&quot;rssi&quot;:-89,&quot;distance&quot;:21.51847,&quot;servicedata&quot;:&quot;fe0000000000000000000000000000000000000000&quot;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>home/OpenMQTTGateway/BTtoMQTT/C7FaaD132C00 {&quot;id&quot;:&quot;c7:fa:ad:13:2c:00&quot;,&quot;rssi&quot;:-68,&quot;distance&quot;:2.799256,&quot;servicedata&quot;:&quot;drfgdrgdsrgesrdgdrgdregesrgtrhtyhtfyhdtyhh&quot;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The subtopic after <code>home/BTtoMQTT/</code> is the MAC address of the Bluetooth low energy beacon.  The rssi value is the <a href="https://www.metageek.com/training/resources/understanding-rssi.html" target="_blank" rel="noopener noreferrer">RSSI signal level<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> from which you may deduce the relative distance to the device.
Consider the distance as a beta featuer as currently we are not retrieving the emitting power of the beacon to make it more accurate.</p> <p>Note that you can find apps to simulate beacons and do some tests like <a href="https://play.google.com/store/apps/details?id=net.alea.beaconsimulator" target="_blank" rel="noopener noreferrer">Beacon simulator<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>IOS version &gt;=10 devices advertise without an extra app a mac address, nevertheless this address <a href="https://github.com/1technophile/OpenMQTTGateway/issues/71" target="_blank" rel="noopener noreferrer">changes randomly<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and cannot be used for presence detection. You must install an app to advertise a fixed MAC address.</p> <h2 id="receiving-signals-from-ble-devices-mi-flora-mi-jia-lywds02-lywsd03mmc-cleargrass-mi-scale-and-many-more"><a href="#receiving-signals-from-ble-devices-mi-flora-mi-jia-lywds02-lywsd03mmc-cleargrass-mi-scale-and-many-more" class="header-anchor">#</a> Receiving signals from BLE devices Mi Flora, Mi jia, LYWDS02, LYWSD03MMC, ClearGrass, Mi scale and <a href="https://compatible.openmqttgateway.com/index.php/devices/ble-devices/" target="_blank" rel="noopener noreferrer">many more<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>So as to receive BLE sensors data you need either a simple ESP32 either an ESP8266/arduino + HM10/11 with firmware &gt;= v601
The mi flora supported firmware is &gt;3.1.8</p> <p>Verify that your sensor is working with the App and update it with the last software version.
You should see in your MQTT broker the following data:
<img src="data:image/png;base64,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" alt=""></p> <p>Note that the gateway return one or two measurement value each time. The different measures depending on the devices are:</p> <ul><li>Lux</li> <li>Temperature</li> <li>Moisture</li> <li>Fertilization</li> <li>Humidity</li> <li>Pressure</li> <li>Steps</li> <li>Weight</li> <li>Impedance</li> <li>Battery</li> <li>Voltage</li> <li>Open</li> <li>Presence</li></ul> <p>The infos will appear like this on your MQTT broker:</p> <p><code>home/OpenMQTTGateway/BTtoMQTT/4C33A6603C79 {&quot;hum&quot;:&quot;52.6&quot;,&quot;tempc&quot;:&quot;19.2&quot;,&quot;tempf&quot;:&quot;66.56&quot;}</code></p> <p>More info are available on <a href="https://1technophile.blogspot.fr/2017/11/mi-flora-integration-to-openmqttgateway.html" target="_blank" rel="noopener noreferrer">my blog<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>  (especially about how it was implemented with HM10)</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The HM10 module doesn't read enough information (servicedata UUID is missing) to support Mi Scale and Mi Band. They are supported nevertheless with ESP32.
OpenMQTTGateway publish the servicedata field of your BLE devices, with HM10 this field can be longer compared to ESP32 if the device is not recognised.</p></div> <h2 id="setting-a-white-or-black-list"><a href="#setting-a-white-or-black-list" class="header-anchor">#</a> Setting a white or black list</h2> <p>A black list is a list of mac adresses that will never be published by OMG
to set black list
<code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;black-list&quot;:[&quot;01:23:14:55:16:15&quot;,&quot;4C:65:77:88:9C:79&quot;,&quot;4C:65:A6:66:3C:79&quot;]}'</code></p> <p>A white list is a list of mac adresses permitted to be published by OMG
to set white list
<code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;white-list&quot;:[&quot;01:23:14:55:16:15&quot;,&quot;4C:65:77:88:9C:79&quot;,&quot;4C:65:A6:66:3C:79&quot;]}'</code></p> <p>Note: if you want to filter (white or black list) on BLE sensors that are auto discovered, you need to wait for the discovery before applying the white or black list</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>So as to keep your white/black list persistent you can publish it with the retain option of MQTT (-r with mosquitto_pub or retain check box of MQTT Explorer)
<code>mosquitto_pub -r -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;white-list&quot;:[&quot;01:23:14:55:16:15&quot;,&quot;4C:65:77:88:9C:79&quot;,&quot;4C:65:A6:66:3C:79&quot;]}'</code></p></div> <h2 id="setting-the-time-between-ble-scans-and-force-a-scan"><a href="#setting-the-time-between-ble-scans-and-force-a-scan" class="header-anchor">#</a> Setting the time between BLE scans and force a scan</h2> <p>If you want to change the time between readings you can change the interval by MQTT.
For example, if you want the BLE to scan every 66 seconds:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;interval&quot;:66000}'</code></p> <p>you can also force a scan to be done by the following command:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;interval&quot;:0}'</code></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>With Home Assistant, this command is directly available through MQTT auto discovery as a switch into the HASS OpenMQTTGateway device entities list.</p></div> <p>Once the forced scan has completed, the previous scan interval value will be restored. Forcing a scan command trigger also a BLE connect process after the scan (see below).</p> <p>The default value <code>TimeBtwRead</code> is set into config_BT.h or into your .ini file for platformio users.</p> <p>If you want to scan continuously for BLE devices, for example for beacon location you can set the interval to 1ms:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;interval&quot;:1}'</code></p> <p>In this case you should deactivate the BLE connection mechanism to avoid concurrency between scan and connections (see chapter below, bleconnect).</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>For certain devices like LYWSD03MMC OpenMQTTGateway use a connection (due to the fact that the advertized data are encrypted), this connection mechanism is launched after every <code>ScanBeforeConnect</code> per default, you can modify it by following the procedure below.</p></div> <h2 id="setting-the-number-of-scans-between-connection-attempts"><a href="#setting-the-number-of-scans-between-connection-attempts" class="header-anchor">#</a> Setting the number of scans between connection attempts</h2> <p>If you want to change the number of BLE scans that are done before a BLE connect you can change it by MQTT, if you want the BLE connect to be every 30 scans:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;scanbcnct&quot;:30}'</code></p> <p>The BLE connect will be done every 30 * (<code>TimeBtwRead</code> + <code>Scan_duration</code>), 30 * (55000 + 10000) = 1950000ms</p> <h2 id="setting-if-the-gateway-publishes-all-the-ble-devices-scanned-or-only-the-detected-sensors"><a href="#setting-if-the-gateway-publishes-all-the-ble-devices-scanned-or-only-the-detected-sensors" class="header-anchor">#</a> Setting if the gateway publishes all the BLE devices scanned or only the detected sensors</h2> <p>If you want to change this characteristic:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;onlysensors&quot;:true}'</code></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>With Home Assistant, this command is directly avalaible through MQTT auto discovery as a switch into the HASS OpenMQTTGateway device entities list.</p></div> <p>The gateway will publish only the detected sensors like Mi Flora, Mi jia, LYWSD03MMC... and not the other BLE devices. This is usefull if you don't use the gateway for presence detection but only to retrieve sensors data.</p> <h2 id="setting-if-the-gateway-connects-to-ble-devices-eligibles-on-esp32"><a href="#setting-if-the-gateway-connects-to-ble-devices-eligibles-on-esp32" class="header-anchor">#</a> Setting if the gateway connects to BLE devices eligibles on ESP32</h2> <p>If you want to change this characteristic:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;bleconnect&quot;:false}'</code></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>With Home Assistant, this command is directly avalaible through MQTT auto discovery as a switch into the HASS OpenMQTTGateway device entities list.</p></div> <h2 id="setting-if-the-gateway-publish-into-home-assistant-home-presence-topic"><a href="#setting-if-the-gateway-publish-into-home-assistant-home-presence-topic" class="header-anchor">#</a> Setting if the gateway publish into Home Assistant Home presence topic</h2> <p>If you want to publish to Home Assistant presence topic, you can activate this function by the HASS interface (this command is auto discovered), <a href="/integrate/home_assistant.html#mqtt-room-presence">here is a yaml example</a>.
Or by an MQTT command.</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;hasspresence&quot;:true}'</code></p> <h2 id="setting-the-minimum-rssi-accepted-to-publish-device-data"><a href="#setting-the-minimum-rssi-accepted-to-publish-device-data" class="header-anchor">#</a> Setting the minimum RSSI accepted to publish device data</h2> <p>If you want to change the minimum RSSI value accepted for a device to be published, you can change it by MQTT. For example if you want to set -80</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;minrssi&quot;:-80}'</code></p> <p>you can also accept all the devices by the following command:</p> <p><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{&quot;minrssi&quot;:-200}'</code></p> <p>The default value is set into config_BT.h</p> <h2 id="read-write-ble-characteristics-over-mqtt-esp32-only"><a href="#read-write-ble-characteristics-over-mqtt-esp32-only" class="header-anchor">#</a> Read/write BLE characteristics over MQTT (ESP32 only)</h2> <p>The gateway can read and write BLE characteristics from devices and provide the results in an MQTT message.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>These actions will be taken on the next BLE connection, which occurs after scanning and after the scan count is reached, <a href="#setting-the-number-of-scans-between-connection-attempts">see above to set this.</a></p></div> <h3 id="example-write-command"><a href="#example-write-command" class="header-anchor">#</a> Example write command</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{
  &quot;ble_write_address&quot;:&quot;AA:BB:CC:DD:EE:FF&quot;,
  &quot;ble_write_service&quot;:&quot;cba20d00-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;ble_write_char&quot;:&quot;cba20002-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;ble_write_value&quot;:&quot;TEST&quot;,
  &quot;value_type&quot;:&quot;STRING&quot;,
  &quot;ttl&quot;:4 }'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Response:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  &quot;id&quot;:&quot;AA:BB:CC:DD:EE:FF&quot;,
  &quot;service&quot;:&quot;cba20d00-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;characteristic&quot;:&quot;cba20002-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;write&quot;:&quot;TEST&quot;,
  &quot;success&quot;:true
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="example-read-commnad"><a href="#example-read-commnad" class="header-anchor">#</a> Example read commnad</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{
  &quot;ble_read_address&quot;:&quot;AA:BB:CC:DD:EE:FF&quot;,
  &quot;ble_read_service&quot;:&quot;cba20d00-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;ble_read_char&quot;:&quot;cba20002-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;value_type&quot;:&quot;STRING&quot;,
  &quot;ttl&quot;: 2 }'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Response:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  &quot;id&quot;:&quot;AA:BB:CC:DD:EE:FF&quot;,
  &quot;service&quot;:&quot;cba20d00-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;characteristic&quot;:&quot;cba20002-224d-11e6-9fb8-0002a5d5c51b&quot;,
  &quot;read&quot;:&quot;TEST&quot;,
  &quot;success&quot;:true
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The <code>ttl</code> parameter is the number of attempts to connect (defaults to 1), which occur after the BLE scan completes.<br> <code>value_type</code> can be one of: STRING, HEX, INT, FLOAT. Default is STRING if omitted in the message.</p></div> <h2 id="other"><a href="#other" class="header-anchor">#</a> Other</h2> <p>To check your hm10 firmware version upload a serial sketch to the nodemcu (this will enable communication directly with the hm10) and launch the command:
<code>AT+VERR?</code></p> <p>More info about HM-10 is <a href="http://www.martyncurrey.com/hm-10-bluetooth-4ble-modules/" target="_blank" rel="noopener noreferrer">available here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/1technophile/OpenMQTTGateway/edit/development/docs/use/ble.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/2/2021, 9:40:30 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/use/rf.html" class="prev">
        RF gateways  (433mhz/315mhz)
      </a></span> <span class="next"><a href="/use/ir.html">
        IR gateway
      </a>
      ‚Üí
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.90ef2252.js" defer></script><script src="/assets/js/2.c514a7fa.js" defer></script><script src="/assets/js/26.fec69d95.js" defer></script>
  </body>
</html>
